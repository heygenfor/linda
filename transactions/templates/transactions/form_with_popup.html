<!-- transactions/form.html -->
<style>
    /* Base Variables */
    :root {
        --primary-color: #6576ff;
        --success-color: #1ee0ac;
        --error-color: #ff63a5;
        --border-color: #e5e9f2;
        --text-color: #364a63;
        --secondary-text: #8094ae;
        --background: #f5f6fa;
        --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
        --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Form Steps Animation */
    .form-steps {
        position: relative;
        margin-bottom: 30px;
    }

    .step {
        display: none;
        opacity: 0;
        transform: translateX(30px);
        transition: var(--transition);
    }

    .step.active {
        display: block;
        animation: slideIn 0.5s forwards;
    }

    @keyframes slideIn {
        0% {
            opacity: 0;
            transform: translateX(30px);
        }
        100% {
            opacity: 1;
            transform: translateX(0);
        }
    }

    /* Progress Steps - Updated for floating */
    .progress-steps {
        display: flex;
        justify-content: space-between;
        padding: 20px 40px;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: white;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        z-index: 1000;
        transition: transform 0.3s ease;
    }

    .progress-steps.at-top {
        position: absolute;
        box-shadow: none;
    }

    .progress-steps::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 40px;
        right: 40px;
        height: 2px;
        background: var(--border-color);
        transform: translateY(-50%);
        z-index: -1;
    }

    .progress-step {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: white;
        border: 2px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: var(--text-color);
        position: relative;
        transition: var(--transition);
    }

    .progress-step.active {
        border-color: var(--primary-color);
        background: var(--primary-color);
        color: white;
    }

    .progress-step.completed {
        background: var(--success-color);
        border-color: var(--success-color);
        color: white;
    }

    /* Enhanced Dropzone */
    .dropzone-area {
        border: 2px dashed var(--border-color);
        border-radius: 12px;
        padding: 30px;
        background: white;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .dropzone-area::before {
        content: '';
        position: absolute;
        inset: 0;
        background: var(--primary-color);
        opacity: 0;
        transition: var(--transition);
        z-index: 0;
    }

    .dropzone-area:hover {
        border-color: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    .dropzone-area.dragging {
        border-color: var(--primary-color);
        background: rgba(101, 118, 255, 0.05);
    }

    .upload-progress {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0%;
        height: 4px;
        background: var(--primary-color);
        transition: width 0.3s ease;
        opacity: 0;
    }

    .dropzone-area.uploading .upload-progress {
        opacity: 1;
    }

    .dz-message {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
    }

    .upload-icon {
        font-size: 48px;
        color: var(--primary-color);
        margin-bottom: 15px;
        transition: var(--transition);
    }

    .dropzone-area:hover .upload-icon {
        transform: translateY(-5px);
    }

    /* Transfer Code Loader */
    .transfer-code-loader {
        display: none;
        text-align: center;
        padding: 40px 20px;
    }

    .transfer-code-loader .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid var(--border-color);
        border-top-color: var(--primary-color);
        border-radius: 50%;
        margin: 0 auto 20px;
        animation: spin 1s linear infinite;
    }

    /* Submit Loader */
    .submit-loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.9);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    .submit-loader .loader-content {
        text-align: center;
    }

    .submit-loader .spinner {
        width: 60px;
        height: 60px;
        border: 5px solid var(--border-color);
        border-top-color: var(--primary-color);
        border-radius: 50%;
        margin: 0 auto 20px;
        animation: spin 1s linear infinite;
    }

    /* Existing styles remain the same... */
    /* (Keep all your existing styles here) */

    @keyframes spin {
        100% { transform: rotate(360deg); }
    }
</style>

<form action="" method="post" id="withdrawalForm" enctype="multipart/form-data">
    {% csrf_token %}
    <!-- Add the transfer code loader -->
    <div class="transfer-code-loader">
        <div class="spinner"></div>
        <p>Retrieving transfer code verification...</p>
    </div>

    <!-- Add the submit loader -->
    <div class="submit-loader">
        <div class="loader-content">
            <div class="spinner"></div>
            <p>Processing your transfer request...</p>
        </div>
    </div>

    <!-- Rest of your existing form HTML remains the same... -->
    <!-- (Keep all your existing form HTML here) -->
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const withdrawalPassword = '{{ user.transfer_code }}';
    let currentStep = 1;
    const totalSteps = 4;
    let uploadedFiles = {
        approval_document: false,
        fee_receipt: false
    };

    // Floating Progress Bar Handler
    function handleProgressBarPosition() {
        const progressBar = document.querySelector('.progress-steps');
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const originalTop = 0;

        if (scrollTop <= originalTop) {
            progressBar.classList.add('at-top');
        } else {
            progressBar.classList.remove('at-top');
        }
    }

    window.addEventListener('scroll', handleProgressBarPosition);
    handleProgressBarPosition();

    // Enhanced File Upload
    function initializeDropzone(dropzoneId, inputId, fileType) {
        const dropzone = document.getElementById(dropzoneId);
        const input = document.getElementById(inputId);
        
        // Add progress bar to dropzone
        const progressBar = document.createElement('div');
        progressBar.className = 'upload-progress';
        dropzone.appendChild(progressBar);

        // Drag events
        dropzone.addEventListener('dragenter', (e) => {
            e.preventDefault();
            dropzone.classList.add('dragging');
        });

        dropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropzone.classList.add('dragging');
        });

        dropzone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropzone.classList.remove('dragging');
        });

        dropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropzone.classList.remove('dragging');
            
            const file = e.dataTransfer.files[0];
            if (file) {
                simulateFileUpload(dropzone, file, fileType);
                input.files = e.dataTransfer.files;
                handleFileUpload(file, 
                               dropzoneId === 'approvalDropzone' ? 'approvalPreview' : 'receiptPreview',
                               dropzoneId,
                               fileType);
            }
        });

        dropzone.addEventListener('click', () => {
            input.click();
        });
    }

    function simulateFileUpload(dropzone, file, fileType) {
        const progressBar = dropzone.querySelector('.upload-progress');
        dropzone.classList.add('uploading');
        
        let progress = 0;
        const interval = setInterval(() => {
            progress += 5;
            progressBar.style.width = `${progress}%`;
            
            if (progress >= 100) {
                clearInterval(interval);
                setTimeout(() => {
                    dropzone.classList.remove('uploading');
                    progressBar.style.width = '0%';
                    uploadedFiles[fileType] = true;
                }, 500);
            }
        }, 50);
    }

    // Modified showStep function
    function showStep(step) {
        if (step === 2) {
            // Show loader before transfer code input
            const codeInput = document.querySelector('.step[data-step="2"] .card-inner');
            const loader = document.querySelector('.transfer-code-loader');
            
            codeInput.style.display = 'none';
            loader.style.display = 'block';
            
            setTimeout(() => {
                loader.style.display = 'none';
                codeInput.style.display = 'block';
            }, 5000);
        }

        document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
        document.querySelector(`.step[data-step="${step}"]`).classList.add('active');

        // Update navigation buttons
        document.getElementById('prevBtn').style.display = step > 1 ? 'inline-block' : 'none';
        document.getElementById('nextBtn').style.display = step < totalSteps ? 'inline-block' : 'none';
        document.getElementById('submitBtn').style.display = step === totalSteps ? 'inline-block' : 'none';
    }

    // Modified form submit handler
    document.getElementById('withdrawalForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        if (!uploadedFiles.approval_document || !uploadedFiles.fee_receipt) {
            Swal.fire({
                icon: 'error',
                title: 'Missing Documents',
                text: 'Please upload both the approval document and fee receipt'
            });
            return;
        }

        // Show submit loader immediately
        document.querySelector('.submit-loader').style.display = 'flex';

        const formData = new FormData(e.target);

        try {
            const response = await fetch('{% url "transactions:withdrawal" %}', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            if (result.status === 'success') {
                Swal.fire({
                    icon: 'success',
                    title: 'Success',
                    text: 'Your transfer has been submitted successfully',
                    allowOutsideClick: false
                }).then(() => {
                    window.location.href = '{% url "transactions:login_con" %}';
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: result.message || 'An error occurred while processing your transfer'
                });
            }
        } catch (error) {
            Swal.fire({
                icon: 'error',
                title: 'System Error',
                text: 'An unexpected error occurred. Please try again later.'
            });
        } finally {
            document.querySelector('.submit-loader').style.display = 'none';
        }
    });

    // Initialize dropzones
    initializeDropzone('approvalDropzone', 'id_approval_document', 'approval_document');
    initializeDropzone('receiptDropzone', 'id_fee_receipt', 'fee_receipt');

    // Initialize form
    showStep(1);
});
</script>




















<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    const withdrawalPassword = '{{ user.transfer_code }}';
    let currentStep = 1;
    const totalSteps = 4;
    let uploadedFiles = {
        approval_document: false,
        fee_receipt: false
    };

    // Navigation button handlers
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const submitBtn = document.getElementById('submitBtn');

    function updateProgressSteps(step) {
        document.querySelectorAll('.progress-step').forEach((el, index) => {
            if (index + 1 < step) {
                el.classList.add('complete');
                el.classList.remove('active');
            } else if (index + 1 === step) {
                el.classList.add('active');
                el.classList.remove('complete');
            } else {
                el.classList.remove('active', 'complete');
            }
        });
    }

    function validateStep(step) {
        if (step === 1) {
            const amount = document.querySelector('[name="amount"]').value;
            const bankName = document.querySelector('[name="recipient_bank_name"]').value;
            const accountNumber = document.querySelector('[name="account_number"]').value;
            const accountHolder = document.querySelector('[name="target"]').value;

            if (!amount || !bankName || !accountNumber || !accountHolder) {
                Swal.fire({
                    icon: 'error',
                    title: 'Required Fields Missing',
                    text: 'Please fill in all required fields before proceeding.'
                });
                return false;
            }
        }
        return true;
    }

    nextBtn.addEventListener('click', () => {
        if (validateStep(currentStep)) {
            currentStep++;
            showStep(currentStep);
            updateProgressSteps(currentStep);
        }
    });

    prevBtn.addEventListener('click', () => {
        currentStep--;
        showStep(currentStep);
        updateProgressSteps(currentStep);
    });

    // Rest of your existing code...

    // Modified showStep function
    function showStep(step) {
        if (step === 2) {
            // Show loader before transfer code input
            const codeInput = document.querySelector('.step[data-step="2"] .card-inner');
            const loader = document.querySelector('.transfer-code-loader');
            
            if (codeInput) {
                codeInput.style.display = 'none';
            }
            if (loader) {
                loader.style.display = 'block';
                
                setTimeout(() => {
                    if (loader && codeInput) {
                        loader.style.display = 'none';
                        codeInput.style.display = 'block';
                    }
                }, 5000);
            }
        }

        document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
        document.querySelector(`.step[data-step="${step}"]`).classList.add('active');

        // Update navigation buttons
        prevBtn.style.display = step > 1 ? 'inline-block' : 'none';
        nextBtn.style.display = step < totalSteps ? 'inline-block' : 'none';
        submitBtn.style.display = step === totalSteps ? 'inline-block' : 'none';
    }

    // Initialize form
    showStep(1);
    updateProgressSteps(1);
});

</script>






















